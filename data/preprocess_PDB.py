black_list = ['03S', '05L', '06C', '0FI', '0G6', '0JC', '0LI', '0MK', '0PY',
       '0SK', '0T4', '0YT',
       '10485_10486_10487_10488_10489_10490_10491_10492_10493_10494_10495_10496_10497_10498_10499_10500_10501_10502_10503_10504_10505_10506_10507_10508_10509_10510_10511_10512_10513_10514_10515_',
       '10534_10535_10536_10537_10538_10539_10540_10541_10542_10543_10544_10545_10546_10547_10548_10549_10550_10551_10552_10553_10554_10555_10556_10557_10558_10559_10560_10561_10562_10563_10564_',
       '10583_10584_10585_10586_10587_10588_10589_10590_10591_10592_10593_10594_10595_10596_10597_10598_10599_10600_10601_10602_10603_10604_10605_10606_10607_10608_10609_10610_10611_10612_10613_',
       '10632_10633_10634_10635_10636_10637_10638_10639_10640_10641_10642_10643_10644_10645_10646_10647_10648_10649_10650_10651_10652_10653_10654_10655_10656_10657_10658_10659_10660_10661_10662_',
       '10681_10682_10683_10684_10685_10686_10687_10688_10689_10690_10691_10692_10693_10694_10695_10696_10697_10698_10699_10700_10701_10702_10703_10704_10705_10706_10707_10708_10709_10710_10711_',
       '10730_10731_10732_10733_10734_10735_10736_10737_10738_10739_10740_10741_10742_10743_10744_10745_10746_10747_10748_10749_10750_10751_10752_10753_10754_10755_10756_10757_10758_10759_10760_',
       '10779_10780_10781_10782_10783_10784_10785_10786_10787_10788_10789_10790_10791_10792_10793_10794_10795_10796_10797_10798_10799_10800_10801_10802_10803_10804_10805_10806_10807_10808_10809_',
       '10828_10829_10830_10831_10832_10833_10834_10835_10836_10837_10838_10839_10840_10841_10842_10843_10844_10845_10846_10847_10848_10849_10850_10851_10852_10853_10854_10855_10856_10857_10858_',
       '10877_10878_10879_10880_10881_10882_10883_10884_10885_10886_10887_10888_10889_10890_10891_10892_10893_10894_10895_10896_10897_10898_10899_10900_10901_10902_10903_10904_10905_10906_10907_',
       '10926_10927_10928_10929_10930_10931_10932_10933_10934_10935_10936_10937_10938_10939_10940_10941_10942_10943_10944_10945_10946_10947_10948_10949_10950_10951_10952_10953_10954_10955_10956_',
       '10M', '110', '11865_', '11865_11866_', '11866_11867_', '11867_',
       '11965_', '11966_11967_', '11967_', '11967_11968_', '11968_11969_',
       '11969_', '11H', '12072_', '12073_12074_', '12P', '13P', '14061_',
       '14062_14063_14064_14065_14066_14067_', '14107_',
       '14108_14109_14110_14111_14112_14113_', '144', '14U', '14V',
       '15344_', '15345_15346_15347_15348_', '15417_',
       '15418_15419_15420_15421_', '157', '158', '15P', '166', '167',
       '16D', '16E', '16P', '18007_18008_', '18009_',
       '18095_18096_18097_', '18150_18151_', '18152_', '18231_',
       '18232_18233_', '18563_18564_18565_18566_',
       '18716_18717_18718_18719_', '18878_18879_18880_18881_',
       '18973_18974_18975_18976_', '18978_18979_18980_18981_ 290',
       '19072_19073_19074_19075_', '19205_19206_19207_19208_ AST', '1BO',
       '1CL', '1CO', '1DO', '1GN ACY GAL 1GN BGC ACY GAL BGC', '1KA',
       '1N0', '1N7', '1PE', '1PE 1PE', '1PG', '1PS', '1PT', '1QO', '1QW',
       '1WD', '1WV', '20036_20037_20038_20039_',
       '20106_20107_20108_20109_', '20161_20162_20163_',
       '20167_20168_20169_20170_', '20168_20169_20170_20171_',
       '20186_20187_20188_ URC', '20192_20193_20194_20195_',
       '20208_20209_20210_20211_', '20277_20278_20279_',
       '20279_20280_20281_20282_', '20281_20282_20283_20284_',
       '20341_20342_20343_ URC', '20351_20352_20353_20354_',
       '20362_20363_20364_20365_', '20G', '20H', '211', '21C', '21F',
       '21J', '21K', '21M', '21R', '21S', '21Y', '22C', '22L', '23E',
       '250', '26128_26129_', '26130_', '26239_26240_', '26241_',
       '26250_26251_', '26252_', '26298_26299_', '26300_', '26363_26364_',
       '26365_', '26445_26446_', '26447_', '26510_26511_', '26512_',
       '26575_26576_', '26577_', '26J', '28T', '2A2', '2BR', '2CV', '2EH',
       '2HP', '2J3', '2JX', '2ME', '2MM', '2NO', '2NV', '2OP', '2P3',
       '2PE', '2PE PEG', '2PO', '2XE', '2XG', '2XH', '2XO', '2XR',
       '30692_', '30693_30694_30695_30696_', '30773_',
       '30774_30775_30776_30777_', '30854_', '30855_30856_30857_30858_',
       '30935_', '30936_30937_30938_30939_', '31', '31I', '3225_3226_',
       '3227_', '33O', '34H', '3CX', '3F7', '3F8', '3FX', '3GF', '3GR',
       '3NP', '3O5', '3P9', '3PE', '3PH', '3PL', '3PO', '3QV', '3W3',
       '3W6', '3W8', '3W9', '3XT', '4050_', '4051_',
       '4225_4226_4227_4228_4229_4230_4231_4232_4233_4234_4235_4236_4237_4238_4239_4240_4241_4242_4243_4244_4245_4246_4247_4248_4249_4250_4251_4252_4253_4254_4255_4256_4257_4258_4259_4260_4261_4262_',
       '4478_4479_4480_4481_4482_4483_4484_4485_4486_4487_4488_4489_4490_4491_4492_4493_4494_4495_',
       '4496_4497_4498_4499_4500_4501_4502_4503_4504_4505_4506_4507_4508_4509_4510_4511_4512_4513_',
       '4514_',
       '4520_4521_4522_4523_4524_4525_4526_4527_4528_4529_4530_4531_',
       '4532_4533_4534_4535_4536_4537_4538_4539_4540_4541_4542_4543_4544_4545_4546_4547_4548_4549_',
       '478', '4795_4796_', '4797_', '4810_4811_', '4812_',
       '4985_4986_4987_4988_4989_4990_4991_4992_4993_4994_4995_4996_4997_4998_4999_5000_5001_5002_',
       '4D6', '4GD', '4HA', '4J6', '4K3', '4MM', '4MO', '4NF', '4PF',
       '4PO', '4TD', '4V4', '4ZW',
       '5003_5004_5005_5006_5007_5008_5009_5010_5011_5012_5013_5014_5015_5016_5017_5018_5019_5020_',
       '5070_5071_5072_5076_5077_5078_5079_5080_5081_5082_5083_5084_5085_5086_5087_',
       '5073_5074_', '5088_',
       '5094_5095_5096_5097_5098_5099_5100_5101_5102_5103_5104_5105_',
       '50A', '5138_',
       '5144_5145_5146_5147_5148_5149_5150_5151_5152_5153_5154_5155_',
       '51K', '5986_', '5987_5988_', '5AD', '5GF', '5HD', '5UT', '5VU',
       '5WE', '6072_', '6073_', '6351_', '6352_6353_', '6360_6361_',
       '6362_', '6396_6397_', '6398_', '63U', '63V', '6474_6475_',
       '6476_', '6516_6517_', '6518_', '6H0', '6H3', '6HE', '6L8', '6LB',
       '6LR', '6MO', '6NA', '6PH', '6QO', '6SE', '6XI', '6YW', '6Z8',
       '7147_', '7148_', '7278_', '7279_', '74C', '78M', '78N', '7ES',
       '7G5', '7G9', '7HE', '7JZ', '7MT', '7NQ', '7NT', '7PE', '7PG',
       '7PH', '7WF', '86V', '86Y', '87O', '8BS', '8EY', '8K6', '8M0',
       '8P5', '8P8 CO3', '8PE', '8SP', '8WE', '8YA', '8YD', '8ZG', '8ZO',
       '91D', '91G', '91S', '9257_', '9258_9259_9260_', '92V', '9312_',
       '9313_9314_', '9415_', '9416_9417_', '9421_9422_9423_9424_',
       '9470_9471_9472_9473_', '9494_9495_9496_9497_', '9C1', '9EF',
       '9JE', '9KX', '9ON', '9PE', '9S8', 'A2G', 'A2G GAL', 'A2G NAG',
       'A4G', 'A4W', 'A8U', 'A9J', 'AA8', 'AAC', 'AAE', 'ACE',
       'ACE ASP GLN MET ASJ', 'ACE ASP GLU VAL ASP 0QE',
       'ACE ASP GLU VAL ASP ASP GLU VAL ASP', 'ACE ASP MET GLN ASJ',
       'ACE GLU SER MET ASJ', 'ACE ILE GLU PRO ASJ',
       'ACE SER LYS SER ALA ASP ARG LYS TYR THR LEU',
       'ACE TYR VAL ALA ASP 0QE', 'ACM', 'ACN', 'ACO', 'ACP', 'ACP MG ',
       'ACT', 'ACT CD', 'ACT NDP', 'ACT ODP', 'ACY', 'ACY ACY', 'ADN',
       'ADP', 'AE3', 'AE4', 'AEI', 'AES', 'AF3', 'AG6', 'AGA', 'AI8',
       'AIX', 'AKG', 'AKR', 'AL', 'ALA', 'ALA ALA ALA ALA ALA ALA ALA',
       'ALA ALA LEU ALA PHE', 'ALA ALA SER LEU TYR GLU LYS LYS ALA ALA',
       'ALA HIS HIS HIS HIS ALA',
       'ALA ILE PRO ASN PRO LEU LEU GLY LEU ALA',
       'ALA LYS LEU ALA ALA ALA LEU GLU',
       'ALA LYS LEU ALA ALA ALA LEU GLU HIS HIS',
       'ALA SER ILE ASP ALA GLN', 'ALF', 'ALF GDP', 'ALK', 'ALQ', 'ALU',
       'AMP', 'ANL', 'ANP', 'APC CMA', 'APF', 'AR6', 'ARA', 'ARF', 'ARG',
       'ARG ARG ARG ARG ARG ARG ARG ARG ARG ARG',
       'ARG GLN SER GLU ARG GLY GLU', 'ARG MET ALA ALA ALA ALA LEU',
       'ARG PRO PRO GLY PHE', 'ARG SER VAL VAL GLU', 'ARS', 'ART', 'AS2',
       'ASC', 'ASN', 'ASN ARG SER', 'ASN GLY PRO LEU SER CYS GLY GLN ARG',
       'ASN HIS PRO MET LEU MET ASN LEU LEU',
       'ASN HIS PRO MET LEU MET ASN LEU LEU LYS',
       'ASN ILE THR GLY LEU LEU LEU LEU ARG ASP',
       'ASN SER THR LEU GLN ATO', 'ASO', 'ASP',
       'ASP ILE PRO ILE GLY OAS LYS MET THR',
       'ASP PHE GLU GLU ILE PRO GLU GLU TYS LEU',
       'ASP PHE GLU GLU ILE PRO GLU GLU TYS LEU GLN',
       'ASP PHE SER SER LYS LEU MET', 'ASP PHE SER SER LYS LEU MET GLY',
       'ASP SER PHE ARG GLN SER GLU ARG GLY GLU', 'AST',
       'AST 19300_19301_19302_19303_', 'ATO',
       'ATOMS_3246_3247_3248_3249_3250_3251_3252_3253_3254_3255_3256_3257_3258_',
       'ATOMS_3259_', 'ATP', 'ATP MG', 'AU', 'AU3', 'AZ0', 'AZI', 'AZR',
       'B12', 'B3P', 'B3R', 'B3V', 'B7G', 'B94', 'B9D', 'B9D BGC',
       'B9D BGC B8D', 'BA', 'BA6', 'BA9', 'BAL', 'BAM', 'BBL', 'BCB',
       'BCL', 'BCN', 'BCT', 'BE7', 'BEF', 'BEN', 'BEN GOL', 'BEO', 'BET',
       'BEZ', 'BF2', 'BGC', 'BGC BGC', 'BGC BGC BGC', 'BGC BGC BGC BGC',
       'BGC BGC BGC XYS BGC XYS XYS', 'BGC GAL NGA GAL SIA SIA',
       'BGC GAL SIA NGA GAL SIA', 'BGC GLC', 'BGC GLC GLC GLC', 'BGL',
       'BHG', 'BLA', 'BM3', 'BMA', 'BMA BMA', 'BMA MAN', 'BMA MAN BMA',
       'BMA MAN BMA MAN', 'BMA NAG MAN', 'BME', 'BME BME', 'BML', 'BNG',
       'BO3', 'BOG', 'BPB', 'BPH', 'BQD', 'BR', 'BSY', 'BT7', 'BTB',
       'BU1', 'BU2', 'BU3', 'BUD', 'BV8', 'BVQ', 'BW9', 'BZI', 'BZP',
       'C10', 'C14', 'C15', 'C2H', 'C8E', 'C8G', 'CA', 'CA6', 'CA8',
       'CAC', 'CAD', 'CAJ', 'CAK', 'CAS', 'CAZ', 'CB4', 'CBD', 'CBY',
       'CCD', 'CCN', 'CD', 'CDL', 'CE', 'CE1', 'CE9', 'CFM', 'CFN', 'CHD',
       'CHL', 'CHX', 'CIT', 'CL', 'CL7', 'CLA', 'CLF', 'CLP', 'CLR',
       'CM5', 'CME', 'CMO', 'CMS', 'CMX', 'CN3', 'CN5', 'CN6', 'CNC',
       'CO', 'CO2', 'CO3', 'COA', 'COB', 'COH', 'COI', 'COP', 'CPQ',
       'CPS', 'CPT', 'CS', 'CSD', 'CSO', 'CSS', 'CU', 'CU1', 'CUA', 'CUB',
       'CUG', 'CUM', 'CUN', 'CUO', 'CV0', 'CW2', 'CXS', 'CYN', 'CYN 233',
       'CYS', 'CYS ALA ARG ALA TYR', 'CYS GLY LEU ARG',
       'CYS GLY VAL PRO ALA ILE GLN PRO VAL LEU', 'CYS PLP', 'D10', 'D12',
       'D1D', 'D6N BCT', 'D6N BCT CMO', 'D6N CO3', 'D9G',
       'DA  DT  DA  DC  DT  DG ', 'DA9', 'DAB',
       'DBB DSG VAL MEA VAL GLY GLY DVA DLE BG9', 'DC  DA  DG  DT  DA ',
       'DCW', 'DCX', 'DD9', 'DDQ', 'DEP', 'DET', 'DGA', 'DGD', 'DGG',
       'DGO', 'DH9', 'DIO', 'DKA', 'DMF', 'DMF GOL', 'DMS', 'DMU', 'DMX',
       'DNO', 'DPO', 'DQL', 'DQW', 'DRW', 'DSN', 'DSU', 'DT3', 'DTC',
       'DTD', 'DTL', 'DTO', 'DTP GTP MG ', 'DTP MG  GTP', 'DTT', 'DTU',
       'DTV', 'DW9', 'DWG', 'DWJ', 'DWP', 'DWS', 'DXE', 'DYD', 'E4P',
       'E64', 'EDO', 'EDO DMS', 'EDO EDO', 'EDO EDO EDO EDO', 'EDO GOL',
       'EDT', 'EFK', 'EGC', 'EHL', 'EJO', 'ELI', 'EMC', 'EMM', 'EMT',
       'EOH', 'EP1', 'EPE', 'EPH', 'EQ8', 'ER0', 'ETA', 'ETE', 'ETF',
       'ETM', 'ETX', 'EU', 'EU  PDC PDC', 'EUF', 'F', 'F09', 'F0Z', 'F15',
       'F3S', 'F43', 'F6Q', 'F7Q', 'F8U', 'FA8 3PL', 'FAD', 'FAD 3PL',
       'FAD H2S', 'FAD RAS', 'FAH', 'FAR', 'FC0 ARG VAL OAR', 'FDA',
       'FDE', 'FE', 'FE  CIT', 'FE2', 'FE2 CYN CMO', 'FES', 'FFQ', 'FJP',
       'FK4', 'FKD', 'FLC', 'FLC MG ', 'FME', 'FME SER ASP', 'FMN', 'FMT',
       'FMT NA ', 'FOR', 'FQD', 'FRU', 'FSF', 'FSI', 'FTT', 'FUC',
       'FUC NAG BMA NAG', 'FUL', 'FUQ', 'FV2', 'FWN', 'FZS',
       'G   G   H2U A', 'G1H', 'G1T', 'G2F', 'G2F BGC BGC BGC BGC BGC',
       'G3H', 'G3P', 'G3P G3P', 'G4S DGS G4S DGS', 'G4Z', 'G52', 'G6K',
       'G8Q', 'G8T', 'GA', 'GAI', 'GAL', 'GAL GAL GAL', 'GAL GLA',
       'GAL SIA', 'GB', 'GBL', 'GD', 'GD3', 'GDP', 'GDS', 'GE8', 'GEH',
       'GER', 'GF8', 'GG5', 'GG6', 'GGD', 'GGL', 'GHE', 'GLA', 'GLC',
       'GLC AC1', 'GLC AGL', 'GLC FRU', 'GLC GAL SIA', 'GLC GLC',
       'GLC GLC GLC', 'GLC GLC GLC GLC', 'GLC GLC GLC GLC GLC',
       'GLC GLC GLC GLC GLC GLC', 'GLC GLC GLC GLC GLC GLC GLC',
       'GLC L2P', 'GLC L2P MAN GAL', 'GLC Z9N', 'GLN',
       'GLN ASP THR PHE THR LYS VAL', 'GLN ASP THR PHE THR LYS VAL LYS',
       'GLN SER GLU ARG GLY GLU', 'GLO', 'GLP', 'GLU',
       'GLU ALA SER PHE PRO', 'GLU CYS', 'GLU GLU ASN ASP PRO ASP TYR',
       'GLU HIS ALA SER ILE ASP ALA GLN',
       'GLU SER THR XOK SER VAL SER ASP', 'GLU VAL ASP ASP TRP GLU PHE',
       'GLV', 'GLY', 'GLY ALA PHE GLN ASN LEU PHE GLN SER VAL',
       'GLY ALA TYR GLY ALA GLY LEU ALA HIS', 'GLY ARG LYS',
       'GLY ARG LYS HIS', 'GLY ARG LYS HIS SER',
       'GLY ASP PHE GLU GLU ILE PRO GLU GLU TYS LEU', 'GLY GLY GLY',
       'GLY LYS HIS ARG THR PHE TYR TYR PRO',
       'GLY LYS HIS ARG THR PHE TYR TYR PRO GLY',
       'GLY LYS HIS ARG VAL PHE HIS TYR PRO',
       'GLY LYS HIS ARG VAL PHE HIS TYR PRO GLY',
       'GLY SER HIS GLY HIS HIS HIS HIS',
       'GLY SER HIS GLY HIS HIS HIS HIS HIS', 'GMH', 'GOA', 'GOL',
       'GOL DMF', 'GOL GOL', 'GP7', 'GR1', 'GR4', 'GSH', 'GST', 'GTP MG',
       'GUA', 'GUH', 'GW9', 'GWN', 'GWW', 'GX2', 'GXT', 'H1T', 'H1W',
       'H2S', 'H2U', 'H2V', 'H62', 'H76', 'HAE', 'HAI', 'HB0', 'HCA ICS',
       'HCS', 'HCZ', 'HDD', 'HEA', 'HEC', 'HED', 'HEE', 'HEM', 'HEX',
       'HEZ', 'HF2', 'HFL', 'HG', 'HG9', 'HGB', 'HGI', 'HGP', 'HIS',
       'HIS ALA SER ILE ASP ALA', 'HIS ALA SER ILE ASP ALA GLN',
       'HIS HIS HIS HIS', 'HIS HIS HIS HIS HIS HIS NI ',
       'HIS LYS ILE LEU HIS ARG LEU LEU GLN ASP',
       'HIS LYS LEU VAL GLN LEU LEU THR THR THR', 'HIS THR ASN ARG',
       'HIS TYR PRO GLY', 'HOA', 'HOZ', 'HP4', 'HSJ', 'HSQ', 'HSQ NAG',
       'HSY', 'HTG', 'HTH', 'HTO', 'HYP', 'HZN', 'I3C', 'I6P', 'ICE HDZ',
       'ICG', 'ICH', 'ICS', 'ICS CMO', 'ICZ HDZ HDZ', 'IHP IHP ZN  ZN ',
       'IHP ZN ', 'IHS', 'ILE', 'ILE GLU ILE',
       'ILE LYS THR GLU LEU LEU ASN PRO LYS ILE', 'IMD', 'IMD FDE', 'IN',
       'IND', 'INH', 'INS', 'IOD', 'IOL', 'IPA', 'IPE', 'IPR', 'IR',
       'IR3', 'IUM', 'IWH', 'J01', 'J30', 'J7N', 'J7Q', 'J7T', 'J7Z',
       'J85', 'J8B', 'J8E', 'JAO', 'JEF', 'JHH', 'JIF', 'JPP', 'JQG',
       'JT2', 'JUT', 'JW8', 'JZR', 'K', 'K76', 'K8P', 'K9P', 'KC1', 'KC2',
       'KEG', 'KEN', 'KR', 'L0B', 'L1P', 'L2C', 'L2P', 'L3P', 'L4A', 'LA',
       'LAB', 'LBF', 'LCP', 'LD2', 'LDA', 'LDM', 'LEA',
       'LEU ASN HIS SER PHE PHE LYS GLN ILE', 'LEU GLY',
       'LEU GLY SER GLY THR ARG',
       'LEU LEU ARG TYR LEU LEU ASP LYS ASP ASP', 'LFA', 'LH8', 'LHG',
       'LHW', 'LI', 'LI1', 'LJB', 'LJN', 'LMB', 'LMR', 'LMT', 'LMU',
       'LNK', 'LOC', 'LOP', 'LP0', 'LPD', 'LPI', 'LPJ', 'LPP', 'LQ5',
       'LSN', 'LU', 'LXC', 'LYS',
       'LYS A8E LYS VAL TRP GLY SER ILE LYS ARG LEU',
       'LYS ILE LEU HIS ARG LEU LEU GLN',
       'LYS ILE LEU HIS ARG LEU LEU GLN ASP',
       'LYS ILE LEU HIS ARG LEU LEU GLN ASP SER', 'M10', 'M12', 'M1R',
       'M1X', 'M27', 'M2M', 'M43', 'M6P', 'M8M', 'MA4', 'MAF BMA BMA',
       'MAN', 'MAN GCU RAM', 'MAN GCU RAM XYP MXY',
       'MAN GCU RAM XYP MXY G4D BGC', 'MAN GCU RAM XYP MXZ GLA BGC',
       'MAN GCU RAM XYS', 'MAN MAN', 'MAO', 'MB3', 'MBN', 'MBO', 'MBV',
       'MC3', 'MCR', 'MD1', 'MDL', 'MDN', 'ME2', 'MEE', 'MES', 'MET',
       'MET ALA ASP PHE VAL ALA ASN THR', 'MG', 'MG  2PN', 'MG  CL',
       'MG  FLC', 'MG  GTP DTP', 'MG  PO4', 'MG  POP', 'MG  PRP',
       'MG  TTP', 'MG  VO4', 'MG A', 'MG B', 'MG TTP', 'MG VO4', 'MG8',
       'MGF', 'MGF ADP', 'MH2', 'MHA', 'MHZ', 'MI9', 'MJB', 'MK7', 'MK8',
       'MLA', 'MLI', 'MLT', 'MMC', 'MN', 'MN0', 'MN3', 'MNH', 'MNR', 'MO',
       'MOH', 'MOM', 'MOO', 'MOO MG ', 'MOV', 'MOW', 'MPD', 'MPG', 'MPL',
       'MPO', 'MRD', 'MRY', 'MTL', 'MTN', 'MXE', 'MYA ZN',
       'MYA ZN  ZN  MYA ZN', 'MYR', 'MYS', 'MZN', 'MZQ', 'N', 'N2O',
       'N2P', 'NA  ACT', 'NAD', 'NAD PYZ', 'NAG', 'NAG BMA',
       'NAG FCA NAG MAN MAN', 'NAG FCA NAG MAN MAN NAG', 'NAG FUC',
       'NAG FUC FUC', 'NAG FUC FUC FUC', 'NAG FUC NAG', 'NAG FUC NAG BMA',
       'NAG FUC NAG BMA BMA', 'NAG FUC NAG BMA MAN',
       'NAG FUC NAG BMA MAN MAN', 'NAG FUC NAG BMA MAN NAG',
       'NAG FUC NAG BMA XYL MAN MAN', 'NAG FUC NAG BMA XYP',
       'NAG FUC NAG BMA XYP BMA', 'NAG FUC NAG BMA XYP MAN',
       'NAG FUC NAG BMA XYP MAN MAN', 'NAG FUC NAG BMA XYP MAN NAG',
       'NAG FUC NAG FUC', 'NAG FUC NAG FUC BMA',
       'NAG FUC NAG FUC BMA MAN', 'NAG FUC NAG FUC BMA MAN MAN',
       'NAG FUC NAG MAN XYP MAN', 'NAG FUC NDG', 'NAG FUL', 'NAG FUL NAG',
       'NAG FUL NAG BMA XYP MAN', 'NAG FUL NAG MAN MAN',
       'NAG MAN NAG BMA MAN', 'NAG NAG', 'NAG NAG BMA', 'NAG NAG BMA BMA',
       'NAG NAG BMA BMA BMA', 'NAG NAG BMA BMA MAN',
       'NAG NAG BMA BMA MAN MAN MAN MAN', 'NAG NAG BMA FUC',
       'NAG NAG BMA FUL', 'NAG NAG BMA MAN', 'NAG NAG BMA MAN BMA',
       'NAG NAG BMA MAN MAN', 'NAG NAG BMA MAN MAN BMA',
       'NAG NAG BMA MAN MAN BMA MAN', 'NAG NAG BMA MAN MAN FUC',
       'NAG NAG BMA MAN MAN MAN', 'NAG NAG BMA MAN MAN MAN BMA MAN',
       'NAG NAG BMA MAN MAN MAN BMA MAN MAN MAN',
       'NAG NAG BMA MAN MAN MAN MAN', 'NAG NAG BMA MAN MAN MAN MAN GLC',
       'NAG NAG BMA MAN MAN MAN MAN GLC MAN',
       'NAG NAG BMA MAN MAN MAN MAN GLC MAN MAN',
       'NAG NAG BMA MAN MAN MAN MAN MAN',
       'NAG NAG BMA MAN MAN MAN MAN MAN MAN',
       'NAG NAG BMA MAN MAN MAN MAN MAN MAN MAN',
       'NAG NAG BMA MAN MAN MAN MAN MAN MAN MAN MAN',
       'NAG NAG BMA MAN MAN NAG', 'NAG NAG BMA MAN NAG',
       'NAG NAG BMA XYP MAN', 'NAG NAG FUC', 'NAG NAG FUC BMA',
       'NAG NAG FUC BMA BMA', 'NAG NAG FUC BMA BMA MAN',
       'NAG NAG FUC BMA MAN', 'NAG NAG FUC BMA MAN MAN',
       'NAG NAG FUC BMA MAN MAN NAG', 'NAG NAG FUC GLC MAN BMA',
       'NAG NAG FUC MAN', 'NAG NAG FUC MAN MAN',
       'NAG NAG FUC MAN MAN MAN', 'NAG NAG FUC MAN NAG BMA',
       'NAG NAG FUL', 'NAG NAG FUL BMA', 'NAG NAG FUL BMA MAN',
       'NAG NAG FUL BMA MAN MAN NAG GAL', 'NAG NAG FUL BMA MAN NAG NGK',
       'NAG NAG GLC MAN MAN', 'NAG NAG LGU MAN LGU', 'NAG NAG MAN',
       'NAG NAG MAN BMA', 'NAG NAG MAN BMA BMA MAN',
       'NAG NAG MAN BMA MAN', 'NAG NAG MAN BMA MAN BMA',
       'NAG NAG MAN BMA MAN MAN', 'NAG NAG MAN BMA MAN MAN MAN MAN MAN',
       'NAG NAG MAN BMA MAN MAN MAN MAN MAN MAN', 'NAG NAG MAN MAN',
       'NAG NAG MAN MAN BMA', 'NAG NAG MAN MAN MAN',
       'NAG NAG MAN MAN MAN MAN', 'NAG NAG MAN MAN MAN MAN MAN',
       'NAG NAG NAG', 'NAG NAG NAG NAG', 'NAG NAG RIP', 'NAG NAG TGY',
       'NAG NDG', 'NAG NDG BMA', 'NAG NDG BMA MAN MAN',
       'NAG NDG BMA MAN MAN MAN MAN', 'NAG NDG BMA MAN MAN MAN MAN MAN',
       'NAG NDG FUC', 'NAG NDG MAN', 'NAG NDG MAN BMA MAN',
       'NAG NDG MAN MAN BMA NDG', 'NAG UNX', 'NAP',
       'NBG BGC BGC XYS BGC XYS XYS', 'NCO', 'NDG', 'NDG GAL SIA SIA',
       'NDG NAG', 'NDG NAG BMA', 'NDG NAG BMA BMA MAN MAN MAN', 'NDP',
       'NDS', 'NEN', 'NES', 'NET', 'NFU', 'NGA', 'NGA GAL', 'NGA SER GAL',
       'NH2', 'NH3', 'NH4', 'NHE', 'NI', 'NIZ', 'NKP', 'NL7', 'NLJ',
       'NLM', 'NLS', 'NLV', 'NMX', 'NO', 'NO2', 'NO3', 'NRO', 'NS5',
       'NWA', 'NWJ', 'NXL', 'O', 'O   4MO', 'O   DMS', 'O16', 'O4B',
       'O5S', 'O5V', 'O5Y', 'O67', 'OBL', 'OCD', 'OCR', 'OCS', 'OCT',
       'OH', 'OHI', 'OHO', 'OHY', 'OJ1', 'OLA', 'OLB', 'OLC', 'OLC OLC',
       'OMO', 'ONL', 'OOA', 'OP2', 'ORO', 'OS', 'OXD', 'OXL', 'OXM',
       'OXY', 'OZJ', 'P0J', 'P15', 'P23', 'P33', 'P3G', 'P4C', 'P4G',
       'P4K', 'P5F', 'P6F', 'P6G', 'P70', 'PAM', 'PB', 'PBL', 'PC', 'PC1',
       'PC4', 'PC7', 'PCA', 'PCD', 'PCK', 'PD', 'PDC', 'PDC EU', 'PDD',
       'PDG', 'PDO', 'PDT', 'PE3', 'PE4', 'PE5', 'PE8', 'PEE', 'PEG',
       'PEG PEG', 'PEG PEG PEG PEG PEG', 'PEK', 'PEO', 'PER', 'PEU',
       'PFB', 'PFB BRB', 'PG0', 'PG4', 'PG4 EDO', 'PG5', 'PG6', 'PGA',
       'PGD O   O', 'PGE', 'PGE GOL', 'PGF', 'PGK', 'PGO', 'PGR', 'PGT',
       'PGV', 'PGW', 'PHE', 'PHE ALA PHE', 'PHE ARG GLN SER GLU ARG',
       'PHE ARG GLN SER GLU ARG GLY GLU',
       'PHE ASN ILE VAL GLY THR THR TYR PRO CYS', 'PHE CSI LEU PHA',
       'PHE CYS LYS LYS ALA ASP ASP CYS',
       'PHE CYS LYS LYS ALA ASP PRO CYS', 'PHE LEU GLN GLU GLN ALA GLN',
       'PHE LYS TPO', 'PHN', 'PHQ VAL ALA ASP CF0', 'PHQ VAL GLU ILE 4H0',
       'PHS', 'PHU', 'PHV', 'PI', 'PI  TL', 'PIN', 'PJ7', 'PJ7 GOL',
       'PLM', 'PLP', 'PLP NAK', 'PLR', 'PNS', 'PO2', 'PO3', 'PO4',
       'PO4 ADP MG ', 'PO4 EDO', 'PO4 MG ', 'POA', 'POG', 'POL', 'POP',
       'POP MG', 'PP9', 'PPI', 'PPV', 'PPV MG ', 'PR', 'PRO',
       'PRO ALA PRO PHE', 'PRO ARG ARG ASN TPO LEU PRO ALA MET ASP GLN',
       'PRO ASP PHE SER SER LYS LEU MET GLY',
       'PRO PHE CYS LYS LYS ALA ASP PRO CYS', 'PRP', 'PRP MG ', 'PS5',
       'PS9', 'PSC', 'PSL', 'PT', 'PTD', 'PTE', 'PTK', 'PTL', 'PTR',
       'PTY', 'PXN', 'PYE', 'PYR', 'PZE', 'Q6K', 'QDK', 'QH4', 'QPT',
       'QQ7', 'R16', 'R74', 'R7D', 'RAM', 'RB', 'RB0', 'RED', 'RET',
       'RET RET', 'RF4', 'RF5', 'RHU', 'RJA', 'RM9', 'RMO', 'ROP', 'RPN',
       'RSF', 'RSG', 'RSH', 'RTC', 'RU', 'RU8', 'RUC', 'RUR CMO', 'RUU',
       'S2H', 'S3H', 'S4P', 'S85', 'SAC', 'SAH', 'SAM', 'SAR', 'SAT',
       'SB', 'SBO', 'SBT', 'SCN', 'SCU', 'SE', 'SEL', 'SER', 'SER GLU',
       'SER GLY ALY VAL NLE', 'SER LEU GLN PHE LEU LEU ASP THR',
       'SER PHE ARG GLN SER GLU ARG GLY GLU', 'SER SER',
       'SER SER LEU SER PRO THR', 'SER VAL GLU GLN VAL', 'SEY', 'SF3',
       'SF4', 'SFO', 'SFR', 'SFS', 'SFU', 'SGM', 'SHG', 'SHN', 'SI3',
       'SIA', 'SIN', 'SM', 'SMM', 'SO2', 'SO3', 'SO4', 'SO4 EDO',
       'SO4 NA', 'SO4 SO4', 'SOF', 'SOG', 'SPD', 'SPH', 'SPL', 'SPM',
       'SPO', 'SPV', 'SR', 'SRT', 'SSN', 'T2C', 'T3A', 'TAJ', 'TAM',
       'TAR', 'TAS', 'TAU', 'TB', 'TB6', 'TB8', 'TBE', 'TBF', 'TBU',
       'TCE', 'TE', 'TEM', 'TEO', 'TEW', 'TFA', 'TG1', 'TGL', 'THJ',
       'THR', 'THR ARG GLY LEU VAL PRO ARG GLY SER',
       'THR LYS ALA ALA ARG M3L SER ALA PRO ALA THR', 'THR LYS VAL LYS',
       'THR PHE THR LYS VAL LYS', 'TL', 'TLA', 'TMA', 'TMO', 'TOE', 'TP8',
       'TPO', 'TQY FRU', 'TRD', 'TRP',
       'TRP ASP SER PHE ARG GLN SER GLU ARG GLY GLU', 'TRS', 'TRT', 'TS6',
       'TTN', 'TTP MG ', 'TUE', 'TWN', 'TWT', 'TYR', 'TYS', 'TZA', 'U1',
       'UDP', 'UEG', 'UFP', 'UMC', 'UMP', 'UMQ', 'UN1', 'UND',
       'UNK UNK UNK', 'UNK UNK UNK UNK', 'UNK UNK UNK UNK UNK',
       'UNK UNK UNK UNK UNK UNK', 'UNK UNK UNK UNK UNK UNK UNK',
       'UNK UNK UNK UNK UNK UNK UNK UNK', 'UNL', 'UNL UNL', 'UNX',
       'UNX UNX', 'UNX UNX UNX', 'UNX UNX UNX UNX',
       'UNX UNX UNX UNX UNX UNX UNX', 'UPL', 'UQ', 'UQ6', 'URE', 'UVW',
       'UZ9', 'VAL', 'VAL LYS', 'VAL PHE HIS TYR PRO GLY',
       'VAL THR PRO LEU ASN', 'VN3', 'VN4', 'VO4', 'VV6', 'VVO', 'VX',
       'VXA', 'W', 'W   WO4', 'WBD', 'WCC', 'WO3', 'WO4', 'X3H', 'XE',
       'XEB', 'XLS', 'XLX', 'XPE', 'XY2', 'XYL', 'XYL XYP XYP GCV', 'XYP',
       'XYS', 'Y01', 'Y1', 'Y8I', 'YB', 'YCN', 'YEG', 'YI6', 'YT3', 'Z22',
       'Z6J', 'Z88', 'ZCM', 'ZDC', 'ZGP', 'ZN', 'ZN  POP', 'ZN A', 'ZNH',
       'ZPG', 'ZPN', 'ZWI']

with open('test_ligands_smiles.txt', 'r') as f:
    smiles_in_test = [s[:-1] for s in f.readlines()]

with open('pdb_file_2019.txt', 'r') as f:
    complexes_2019 = [s[:-1] for s in f.readlines()]
    
    
import http_requests
import json


def to_dict(odict):
    '''Convert OrderedDict to dict
    Takes a nested, OrderedDict() object and outputs a
    normal dictionary of the lowest-level key:val pairs
    Parameters
    ----------
    odict : OrderedDict
    Returns
    -------
    out : dict
        A dictionary corresponding to the flattened form of
        the input OrderedDict
    '''
    out = json.loads(json.dumps(odict))
    return out


cache_chemicals = {}

def describe_chemical(chem_id):
    #out = get_info(chem_id, url_root = 'http://www.rcsb.org/pdb/rest/describeHet?chemicalID=')
    if chem_id in cache_chemicals:
        return cache_chemicals[chem_id]
    url = '''https://data.rcsb.org/graphql?query={
  chem_comps(comp_ids: "''' + chem_id + '''") {
    pdbx_chem_comp_descriptor {
      descriptor
      type
      program
    }
  }
}'''
    response = http_requests.request_limited(url)

    if response is None or response.status_code != 200:
        warnings.warn("Retrieval failed, returning None")
        return None

    result = str(response.text)

    out = json.loads(result)
    out = to_dict(out)
    cache_chemicals[chem_id] = out
    return out


import sys
from prody import *
from rdkit import Chem
from rdkit.Chem import AllChem
from io import StringIO
import os
from rdkit import RDLogger
RDLogger.DisableLog('rdApp.*')
from tqdm import tqdm
import os
import warnings
warnings.filterwarnings('ignore')

def get_pdb_components(pdb_id):
    """
    Split a protein-ligand pdb into protein and ligand components
    :param pdb_id:
    :return:
    """
    pdb = parsePDB(pdb_id)
    protein = pdb.select('protein')
    ligand = pdb.select('not protein and not water')
    return protein, ligand


def process_ligand(ligand, res_name, chain, res_num):
    """
    Add bond orders to a pdb ligand
    1. Select the ligand component with name "res_name"
    2. Get the corresponding SMILES from pypdb
    3. Create a template molecule from the SMILES in step 2
    4. Write the PDB file to a stream
    5. Read the stream into an RDKit molecule
    6. Assign the bond orders from the template from step 3
    :param ligand: ligand as generated by prody
    :param res_name: residue name of ligand to extract
    :return: molecule with bond orders assigned
    """
    if res_name in black_list:
        #print(res_name, "in black list")
        return None
    output = StringIO()
    sub_mol = ligand.select(f"resname {res_name} chain {chain} resindex {res_num}")
    chem_desc = describe_chemical(f"{res_name}")
    if chem_desc is None:
        #print("chem_desc of ", res_name, "is None")
        return None

    sub_smiles = chem_desc["data"]["chem_comps"][0]["pdbx_chem_comp_descriptor"]
    chosen_smile = None
    for d in sub_smiles:
        if d['type'] == "SMILES_CANONICAL" and d['program'] == 'OpenEye OEToolkits':
            chosen_smile = d['descriptor']
    if chosen_smile is None:
        #print("chosen_smile of ", res_name, "is None")
        return None

    template = AllChem.MolFromSmiles(chosen_smile)
    writePDBStream(output, sub_mol)
    pdb_string = output.getvalue()
    rd_mol = AllChem.MolFromPDBBlock(pdb_string)
    
    try:
        new_mol = AllChem.AssignBondOrdersFromTemplate(template, rd_mol)
    except Exception as e:
        #print('failed on', res_name, e)
        return None
    
    #print(new_mol.GetNumAtoms(), Chem.RemoveHs(new_mol).GetNumAtoms())
    if new_mol.GetNumAtoms() < 3:
        #print(res_name, "with", new_mol.GetNumAtoms(), "is too small to be included")
        return None
    
    if Chem.MolToSmiles(Chem.RemoveHs(new_mol)) in smiles_in_test:
        #print("skipped", res_name, "because in test set")
        return None
    return new_mol


def write_pdb(protein, pdb_name):
    """
    Write a prody protein to a pdb file
    :param protein: protein object from prody
    :param pdb_name: base name for the pdb file
    :return: None
    """
    output_pdb_name = f"{pdb_name}_protein.pdb"
    writePDB(f"{output_pdb_name}", protein)
    #print(f"wrote {output_pdb_name}")


def write_sdf(new_mol, pdb_name, res_name):
    """
    Write an RDKit molecule to an SD file
    :param new_mol:
    :param pdb_name:
    :param res_name:
    :return:
    """
    outfile_name = f"{pdb_name}_{res_name}_ligand.sdf"
    writer = Chem.SDWriter(f"{outfile_name}")
    writer.write(new_mol)
    #print(f"wrote {outfile_name}")


subdirectories = [f.name for f in os.scandir('PDB') if f.is_dir()]
print(subdirectories[:20])
count = 0

for pdbid in tqdm(subdirectories):
    try:
        protein, ligand = get_pdb_components('PDB/' + pdbid + '/' + pdbid + '.pdb')
        if protein is None or ligand is None:
            continue
        write_pdb(protein, 'PDB/' + pdbid + '/' + pdbid)

        res_name_list = list(set(zip(ligand.getResnames(), ligand.getChids(), ligand.getResindices())))
        for res_name, chain, res_num in res_name_list:
            new_mol = process_ligand(ligand, res_name, chain, res_num)
            if new_mol is not None:
                write_sdf(new_mol, 'PDB/' + pdbid + '/' + pdbid, res_name + '_' + chain + '_' + str(res_num))
                count += 1

    except Exception as e:
        print("failed", pdbid, "for", e)


